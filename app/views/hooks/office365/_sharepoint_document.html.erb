<% if issue.sharepoint_supports_embed? %>
  <%# Excel, PowerPoint: iframe embed í‘œì‹œ %>
  <div class="sharepoint-embed" style="margin-top: 10px;">
    <iframe
      src="<%= issue.sharepoint_embed_url(site_url: site_url) %>"
      width="100%"
      height="600px"
      frameborder="0"
      allowfullscreen="true"
      style="border: 1px solid #e0e0e0; border-radius: 4px;">
    </iframe>
  </div>
<% else %>
  <%# Word, PDF ë“±: ë§í¬ë§Œ í‘œì‹œ %>
  <div class="sharepoint-embed" style="margin-top: 10px; padding: 15px; background: #f5f5f5; border: 1px solid #e0e0e0; border-radius: 4px;">
    <p style="margin: 0 0 10px 0;">
      <strong>ğŸ“„ <%= issue.sharepoint_file_type&.capitalize || 'SharePoint' %> ë¬¸ì„œ</strong>
    </p>
    <p style="margin: 0; font-size: 0.9em; color: #666;">
      ì´ ë¬¸ì„œëŠ” iframe embedë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì•„ë˜ ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ìƒˆ ì°½ì—ì„œ ì—¬ì„¸ìš”.
    </p>
    <p style="margin: 10px 0 0 0;">
      <% source_url = issue.sharepoint_source_url %>
      <% if source_url %>
        <a href="<%= source_url %>" target="_blank" rel="noopener noreferrer"
           style="display: inline-block; padding: 8px 16px; background: #0078d4; color: white; text-decoration: none; border-radius: 4px;">
          ìƒˆ ì°½ì—ì„œ ì—´ê¸° â†’
        </a>
      <% else %>
        <span style="color: #999;">ì›ë³¸ URLì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>
      <% end %>
    </p>
  </div>
<% end %>

<script>
(function() {
  // 'ì„¤ëª…' í—¤ë” ë°”ë¡œ ë‹¤ìŒìœ¼ë¡œ SharePoint ë¬¸ì„œ ë°•ìŠ¤ ì´ë™
  function moveSharePointBox() {
    var sharepointBox = document.querySelector('.sharepoint-embed');
    if (!sharepointBox) return;

    // ì´ë¯¸ ì´ë™í–ˆìœ¼ë©´ ì¤‘ë³µ ë°©ì§€
    if (sharepointBox.getAttribute('data-moved') === 'true') return;

    // 'ì„¤ëª…' ì„¹ì…˜ì˜ ìœ„í‚¤ ì½˜í…ì¸  ì˜ì—­ ì°¾ê¸°
    var descriptionDiv = document.querySelector('div.issue div.description');

    if (descriptionDiv) {
      // h4 í—¤ë”('ì„¤ëª…') ì°¾ê¸°
      var header = descriptionDiv.querySelector('h4');

      if (header) {
        // h4 í—¤ë” ë°”ë¡œ ë‹¤ìŒì— ì‚½ì…
        header.parentNode.insertBefore(sharepointBox, header.nextSibling);
      } else {
        // í—¤ë”ê°€ ì—†ìœ¼ë©´ description div ë§¨ ì•ì— ì‚½ì…
        descriptionDiv.insertBefore(sharepointBox, descriptionDiv.firstChild);
      }

      sharepointBox.setAttribute('data-moved', 'true');
    }
  }

  // DOM ë¡œë“œ ì™„ë£Œ ì‹œ ë˜ëŠ” ì¦‰ì‹œ ì‹¤í–‰
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', moveSharePointBox);
  } else {
    moveSharePointBox();
  }
})();
</script>
